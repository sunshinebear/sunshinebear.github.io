(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{360:function(t,s,a){"use strict";a.r(s);var e=a(42),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"业务组件架构改造之ui和逻辑分离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#业务组件架构改造之ui和逻辑分离"}},[t._v("#")]),t._v(" 业务组件架构改造之UI和逻辑分离")]),t._v(" "),a("p",[t._v("大型前端项目中一个传统的React业务组件通常包含大量的业务逻辑，对应的状态逻辑和UI。\n"),a("img",{attrs:{src:"https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/reactCom.jpg",alt:"component"}}),t._v("\n当项目比较小的时候，基本上很少会考虑到"),a("font",{attrs:{color:"#FF0000"}},[t._v("UI和逻辑分离")]),t._v("。但是当项目变大的时候，需求越多，代码越加复杂的时候，这件事情就变的更加紧急。")],1),t._v(" "),a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("比如这样的一个sheetsbar业务组件，代码中逻辑和UI混合在一起。")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sheet")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("React")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("addSheet")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 大段增加表格的业务逻辑")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("deleteSheet")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 大段删除表格的业务逻辑")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// UI组件")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sheetbar"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div className"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aria-hide"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Add onAddSheet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addSheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Delete onDeleteSheet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deleteSheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 其他的UI组件 */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("某一天，产品突然提了需求，")]),t._v(" "),a("blockquote",[a("ol",[a("li",[t._v("我们要接入某某平台，他们想"),a("font",{attrs:{color:"#FF0000"}},[a("strong",[t._v("复用逻辑")])]),t._v("，但是用他们自己的UI进行展示，能支持么？")],1),t._v(" "),a("li",[t._v("这个组件，我想"),a("font",{attrs:{color:"#FF0000"}},[a("strong",[t._v("复用UI")])]),t._v("到页面其他的地方去。能实现么？")],1)])]),t._v(" "),a("p",[t._v("无疑，上述组件并不满足这个，需要大量的工作进行拆分。\n这样就要求我们开始编码设计的时候考虑到，进而避免这个问题。")]),t._v(" "),a("h2",{attrs:{id:"业内解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#业内解决方案"}},[t._v("#")]),t._v(" 业内解决方案")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("这里首先看一下业内的通用解决方案。")]),t._v(" "),a("h3",{attrs:{id:"vscode的实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vscode的实现"}},[t._v("#")]),t._v(" vscode的实现")]),t._v(" "),a("p",[t._v("vscode作为当红编辑器，它同时支持"),a("font",{attrs:{color:"#FF0000"}},[t._v("web版和客户端")]),t._v("版本，那它是如果做UI分离的呢？\n以下操作为例：")],1),t._v(" "),a("ol",[a("li",[t._v("右键点击其顶部的tabs,弹出菜单栏")]),t._v(" "),a("li",[t._v("点击具体菜单选项")])]),t._v(" "),a("h4",{attrs:{id:"electron"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#electron"}},[t._v("#")]),t._v(" electron")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/tabs.png",alt:"tabs"}})]),t._v(" "),a("h4",{attrs:{id:"web版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web版本"}},[t._v("#")]),t._v(" web版本")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/WebTabs.jpg",alt:"tabs-web"}})]),t._v(" "),a("p",[t._v("vscode展示是有"),a("font",{attrs:{color:"#FF0000"}},[t._v("2种")]),t._v("形态。它们虽然看起来差不多，但是底层实现是不一样的。web版采用的是"),a("font",{attrs:{color:"#FF0000"}},[t._v("DOM节点")]),t._v("直接渲染出来，而electron却是通过"),a("font",{attrs:{color:"#FF0000"}},[t._v("原生应用菜单组件")]),t._v("实现的。")],1),t._v(" "),a("h5",{attrs:{id:"_1-右键菜单弹出的实现流程如下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-右键菜单弹出的实现流程如下"}},[t._v("#")]),t._v(" 1. 右键菜单弹出的实现流程如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/contextBar.jpg",alt:"contextBar"}})]),t._v(" "),a("h5",{attrs:{id:"_2-当我们去点击具体的tab菜单选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-当我们去点击具体的tab菜单选项"}},[t._v("#")]),t._v(" 2. 当我们去点击具体的"),a("font",{attrs:{color:"#FF0000"}},[t._v("tab菜单选项")]),t._v("，")],1),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/clickMenu.jpg",alt:"contextBar"}}),t._v("\n触发流程如下：\n"),a("img",{attrs:{src:"https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/MenuClick.jpg",alt:"contextMenu"}}),t._v("\n上面写的流程比较复杂。来一个简化版本的。")]),t._v(" "),a("h5",{attrs:{id:"_3-右键菜单弹出简单流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-右键菜单弹出简单流程"}},[t._v("#")]),t._v(" 3. 右键菜单弹出简单流程：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/simpleContext.png",alt:"simpleContext"}})]),t._v(" "),a("h5",{attrs:{id:"_4-点击具体菜单简单流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-点击具体菜单简单流程"}},[t._v("#")]),t._v(" 4. 点击具体菜单简单流程：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/simpleMenu.jpg",alt:"simpleMenu"}}),t._v("\n由此可以看到，vscode如何做到UI和逻辑分离，主要在于：")]),t._v(" "),a("blockquote",[a("ol",[a("li",[t._v("渲染层做的事情很纯粹，接受Action配置，触发对应的Action，"),a("font",{attrs:{color:"#FF0000"}},[t._v("不涉及")]),t._v("业务逻辑。")],1),t._v(" "),a("li",[t._v("通过Action和Command结合将具体业务和逻辑进行了"),a("font",{attrs:{color:"#FF0000"}},[t._v("分离")]),t._v("。")],1),t._v(" "),a("li",[t._v("控制层可以"),a("font",{attrs:{color:"#FF0000"}},[t._v("动态调整")]),t._v("加载对应的渲染层。")],1)])]),t._v(" "),a("h2",{attrs:{id:"分离架构的思考与设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分离架构的思考与设计"}},[t._v("#")]),t._v(" 分离架构的思考与设计")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("那我们项目的特性是什么呢？")]),t._v(" "),a("blockquote",[a("ol",[a("li",[t._v("组件渲染是由React实现的")]),t._v(" "),a("li",[t._v("业务逻辑直接写入到组件中")])])]),t._v(" "),a("p",[t._v("那借鉴vsCode，我们的将现有组件改造为一个MVP的架构：\n"),a("img",{attrs:{src:"https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/mvp.png",alt:"mvp"}})]),t._v(" "),a("blockquote",[a("ol",[a("li",[t._v("view和Presenter是通过Action进行双向通信的。")]),t._v(" "),a("li",[t._v("View 与 Model 没有交集。")]),t._v(" "),a("li",[t._v("View 非常纯粹，不包含任何业务逻辑，只会简单触发Presenter给它的Action，而 Presenter比较厚，所有业务逻辑包含在里面。")])])]),t._v(" "),a("p",[t._v("此架构优点在于：")]),t._v(" "),a("ul",[a("li",[t._v("减低了耦合，实现了业务逻辑与UI的真正分离。")]),t._v(" "),a("li",[t._v("模块职责分明，层次分明，便于维护。")]),t._v(" "),a("li",[t._v("Presenter层可以复用，一个Presenter可以用于多个UI。")]),t._v(" "),a("li",[t._v("利于单元测试。模块分明，可以有效减少React组件的集成测试，提高效率。")]),t._v(" "),a("li",[t._v("UI和逻辑分离后，为后面组件只读和可编辑分离打下了基础。")])]),t._v(" "),a("p",[t._v("那通过借鉴此架构，最终我们将组件架构进行如下改进:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/improveMvp.png",alt:"MVP_improve"}})]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("vscode作为当红编辑器，有很多坑的地方在写的时候，已经提前考虑到了。阅读其源码无疑是提升技能的很好方法。\n感谢团队成员的支持，并让这个方案最终成功落地，也希望有更多志同道合的人加入我们腾讯文档团队，一起去探索和遨游，最后也希望这篇文章能给到你们一些启发吧😁")])])}),[],!1,null,null,null);s.default=r.exports}}]);