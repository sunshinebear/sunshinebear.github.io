<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>业务组件架构改造之UI和逻辑分离 | 尹邵龙的博客</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Blog">
    <link rel="preload" href="/assets/css/0.styles.3c60507a.css" as="style"><link rel="preload" href="/assets/js/app.01490768.js" as="script"><link rel="preload" href="/assets/js/2.13ef3b3f.js" as="script"><link rel="preload" href="/assets/js/14.9d5a9176.js" as="script"><link rel="prefetch" href="/assets/js/10.eb4e8b82.js"><link rel="prefetch" href="/assets/js/11.6e75fc57.js"><link rel="prefetch" href="/assets/js/12.6fb9bc2b.js"><link rel="prefetch" href="/assets/js/13.4163d664.js"><link rel="prefetch" href="/assets/js/15.4f040164.js"><link rel="prefetch" href="/assets/js/16.5a15b46b.js"><link rel="prefetch" href="/assets/js/17.67ffb5c4.js"><link rel="prefetch" href="/assets/js/18.66ac5882.js"><link rel="prefetch" href="/assets/js/3.387cb282.js"><link rel="prefetch" href="/assets/js/4.b478c532.js"><link rel="prefetch" href="/assets/js/5.6dbcdc06.js"><link rel="prefetch" href="/assets/js/6.1a563297.js"><link rel="prefetch" href="/assets/js/7.88336596.js"><link rel="prefetch" href="/assets/js/8.8514ae46.js"><link rel="prefetch" href="/assets/js/9.e63cd41e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3c60507a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">尹邵龙的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="业务组件架构改造之ui和逻辑分离"><a href="#业务组件架构改造之ui和逻辑分离" class="header-anchor">#</a> 业务组件架构改造之UI和逻辑分离</h1> <p>大型前端项目中一个传统的React业务组件通常包含大量的业务逻辑，对应的状态逻辑和UI。
<img src="https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/reactCom.jpg" alt="component">
当项目比较小的时候，基本上很少会考虑到<font color="#FF0000">UI和逻辑分离</font>。但是当项目变大的时候，需求越多，代码越加复杂的时候，这件事情就变的更加紧急。</p> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <hr> <p>比如这样的一个sheetsbar业务组件，代码中逻辑和UI混合在一起。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Sheet</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function-variable function">addSheet</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 大段增加表格的业务逻辑</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function-variable function">deleteSheet</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
        <span class="token comment">// 大段删除表格的业务逻辑</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// UI组件</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;sheetbar&quot;</span> <span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;aria-hide&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>Add onAddSheet<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>addSheet<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>Delete onDeleteSheet<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>deleteSheet<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token punctuation">{</span><span class="token comment">/* 其他的UI组件 */</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div <span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>某一天，产品突然提了需求，</p> <blockquote><ol><li>我们要接入某某平台，他们想<font color="#FF0000"><strong>复用逻辑</strong></font>，但是用他们自己的UI进行展示，能支持么？</li> <li>这个组件，我想<font color="#FF0000"><strong>复用UI</strong></font>到页面其他的地方去。能实现么？</li></ol></blockquote> <p>无疑，上述组件并不满足这个，需要大量的工作进行拆分。
这样就要求我们开始编码设计的时候考虑到，进而避免这个问题。</p> <h2 id="业内解决方案"><a href="#业内解决方案" class="header-anchor">#</a> 业内解决方案</h2> <hr> <p>这里首先看一下业内的通用解决方案。</p> <h3 id="vscode的实现"><a href="#vscode的实现" class="header-anchor">#</a> vscode的实现</h3> <p>vscode作为当红编辑器，它同时支持<font color="#FF0000">web版和客户端</font>版本，那它是如果做UI分离的呢？
以下操作为例：</p> <ol><li>右键点击其顶部的tabs,弹出菜单栏</li> <li>点击具体菜单选项</li></ol> <h4 id="electron"><a href="#electron" class="header-anchor">#</a> electron</h4> <p><img src="https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/tabs.png" alt="tabs"></p> <h4 id="web版本"><a href="#web版本" class="header-anchor">#</a> web版本</h4> <p><img src="https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/WebTabs.jpg" alt="tabs-web"></p> <p>vscode展示是有<font color="#FF0000">2种</font>形态。它们虽然看起来差不多，但是底层实现是不一样的。web版采用的是<font color="#FF0000">DOM节点</font>直接渲染出来，而electron却是通过<font color="#FF0000">原生应用菜单组件</font>实现的。</p> <h5 id="_1-右键菜单弹出的实现流程如下"><a href="#_1-右键菜单弹出的实现流程如下" class="header-anchor">#</a> 1. 右键菜单弹出的实现流程如下：</h5> <p><img src="https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/contextBar.jpg" alt="contextBar"></p> <h5 id="_2-当我们去点击具体的tab菜单选项"><a href="#_2-当我们去点击具体的tab菜单选项" class="header-anchor">#</a> 2. 当我们去点击具体的<font color="#FF0000">tab菜单选项</font>，</h5> <p><img src="https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/clickMenu.jpg" alt="contextBar">
触发流程如下：
<img src="https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/MenuClick.jpg" alt="contextMenu">
上面写的流程比较复杂。来一个简化版本的。</p> <h5 id="_3-右键菜单弹出简单流程"><a href="#_3-右键菜单弹出简单流程" class="header-anchor">#</a> 3. 右键菜单弹出简单流程：</h5> <p><img src="https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/simpleContext.png" alt="simpleContext"></p> <h5 id="_4-点击具体菜单简单流程"><a href="#_4-点击具体菜单简单流程" class="header-anchor">#</a> 4. 点击具体菜单简单流程：</h5> <p><img src="https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/simpleMenu.jpg" alt="simpleMenu">
由此可以看到，vscode如何做到UI和逻辑分离，主要在于：</p> <blockquote><ol><li>渲染层做的事情很纯粹，接受Action配置，触发对应的Action，<font color="#FF0000">不涉及</font>业务逻辑。</li> <li>通过Action和Command结合将具体业务和逻辑进行了<font color="#FF0000">分离</font>。</li> <li>控制层可以<font color="#FF0000">动态调整</font>加载对应的渲染层。</li></ol></blockquote> <h2 id="分离架构的思考与设计"><a href="#分离架构的思考与设计" class="header-anchor">#</a> 分离架构的思考与设计</h2> <hr> <p>那我们项目的特性是什么呢？</p> <blockquote><ol><li>组件渲染是由React实现的</li> <li>业务逻辑直接写入到组件中</li></ol></blockquote> <p>那借鉴vsCode，我们的将现有组件改造为一个MVP的架构：
<img src="https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/mvp.png" alt="mvp"></p> <blockquote><ol><li>view和Presenter是通过Action进行双向通信的。</li> <li>View 与 Model 没有交集。</li> <li>View 非常纯粹，不包含任何业务逻辑，只会简单触发Presenter给它的Action，而 Presenter比较厚，所有业务逻辑包含在里面。</li></ol></blockquote> <p>此架构优点在于：</p> <ul><li>减低了耦合，实现了业务逻辑与UI的真正分离。</li> <li>模块职责分明，层次分明，便于维护。</li> <li>Presenter层可以复用，一个Presenter可以用于多个UI。</li> <li>利于单元测试。模块分明，可以有效减少React组件的集成测试，提高效率。</li> <li>UI和逻辑分离后，为后面组件只读和可编辑分离打下了基础。</li></ul> <p>那通过借鉴此架构，最终我们将组件架构进行如下改进:</p> <p><img src="https://raw.githubusercontent.com/sunshinebear/blog/master/images/vscode/improveMvp.png" alt="MVP_improve"></p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <hr> <p>vscode作为当红编辑器，有很多坑的地方在写的时候，已经提前考虑到了。阅读其源码无疑是提升技能的很好方法。
感谢团队成员的支持，并让这个方案最终成功落地，也希望有更多志同道合的人加入我们腾讯文档团队，一起去探索和遨游，最后也希望这篇文章能给到你们一些启发吧😁</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.01490768.js" defer></script><script src="/assets/js/2.13ef3b3f.js" defer></script><script src="/assets/js/14.9d5a9176.js" defer></script>
  </body>
</html>
